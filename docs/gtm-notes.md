# Go-To-Market (GTM) / 商用化に向けたメモ

現在「個人用英語学習アプリ」として作成している本プロジェクト（`eng-hype`）を、将来的に**不特定多数が使う商用Webサービス（SaaS等）へ進化させる場合**の懸念点と対応方針まとめ。

## 結論：作り直すか、進化させるか

**「現在のリポジトリをそのままコピー・進化させる（MVPアプローチ）」**が推奨される。
最初から完璧なスケーラビリティやセキュリティを求めてイチから作り直すと、機能開発が止まりモチベーションが枯渇しやすいため。
まずは現状の「自分が欲しい最高の機能」を作り切り、商用化のタイミングで以下のアナを塞いでいく方針とする。

---

## 1. コストとAPI制限（Gemini API）の壁

現在は「Gemini 2.5 Flash」のPaid Tier（従量課金）を使用しており、個人利用では実質無料（1日数十円）かつレートリミット（500 RPM）も上限に達しない。しかし、ユーザーが増えると以下の問題が起きる。

- **コスト増大:** ユーザーが毎日全単語をクリックしまくると、塵積で月額数千円〜数万円に膨れ上がる。
- **Rate Limitの超過:** 特定の時間帯（夜など）にユーザーの利用が集中すると、APIリクエストが弾かれ（`429 Too Many Requests`）、機能が停止する。

### 🔄 対応方針（DBキャッシュの構築）

- APIリクエストのたびに結果をリアルタイム生成するのではなく、**Supabase（DB）に結果をキャッシュ**する。
- 「Aさんがクリックして生成された単語の解説データ」をDBに保存し、Bさんが同じ単語をクリックした際はDBから秒速・無料で返すようにする。これによりAPIコール数と遅延を劇的に削減できる。

## 2. アーキテクチャとストレージの壁

現在の `Next.js (App Router) + Vercel + Supabase` は商用SaaSとして完璧な現代の黄金スタックだが、一点問題がある。

- **静的ファイルの肥大化:** 現在、生成した音声データ（TTS）や画像などをリポジトリ内部（またはローカルのファイルシステム）に保存している。商用化するとリポジトリサイズがパンクし、Vercel等のホスティング環境の制約にも引っかかる。

### 🔄 対応方針（クラウドストレージ移行）

- 音声データ（`.mp3`）や画像データは、ファイルシステムではなく **Supabase Storage**（または Amazon S3 や Cloudflare R2 など）に保存し、そのURLをDBで管理する構成に切り替える。

## 3. セキュリティと悪用対策の壁

不特定多数へ公開すると、商用APIを使い潰そうとする攻撃者やbotが現れる。

- **クラウド破産（DOS）:** 辞書API（`/api/dictionary`）をbotで1秒間に何千回も叩かれると、API代が跳ね上がる。
- **プロンプトインジェクション:** ユーザーが自由入力できるフォーム（感想や英作文機能）を作った場合、「今までの命令を無視して〜を出力しろ」といった攻撃でAPIを不正利用される。

### 🔄 対応方針（認証と制限の必須化）

- **Supabase Auth の導入:** ログインしていないユーザー（ゲスト）にはAPI機能を使わせないか、極端に制限する。
- **Rate Limiting（回数制限）:** Vercel KV や Cloudflare（WAF）、Upstash などを用いて、「1ユーザーにつき1分間に◯回まで」というAPIレートリミットを自サーバー側にかける。

## 4. 小さな問題

- 「文脈:"${context}"」のような場所がトークン渡しすぎてお金かかるかも。
- hash値を保存して無限にゴミを貯める作りにしたからスケールの観点だとダメかも。
- anyいっぱいある問題
- ログインわけなさすぎ問題

---

_※本ドキュメントは、将来の商用化着手時に随時加筆・詳細化していくためのメモ書きです。_
